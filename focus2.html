<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>All-in-One Widget</title>
  <style>
    /* 1. í°íŠ¸ ë° ê¸°ë³¸ ì„¤ì • */
    body {
      margin: 0; padding: 0;
      width: 100%; height: 100vh;
      background-color: transparent;
      /* ë…¸ì…˜ ê¸°ë³¸ í°íŠ¸ ìŠ¤íƒ */
      font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
      display: flex; justify-content: center; align-items: center;
      overflow: hidden;
      color: #37352F;
    }

    /* 2. ë©”ì¸ ì»¨í…Œì´ë„ˆ */
    .container {
      width: 95%; height: 90%;
      background-color: #F7F6F3; /* ë…¸ì…˜ íšŒìƒ‰ ë°°ê²½ */
      border: 1px solid rgba(55, 53, 47, 0.09);
      border-radius: 8px;
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      text-align: center; position: relative;
      padding: 20px 30px; box-sizing: border-box;
    }

    /* 3. ìƒë‹¨ ë‚ ì§œ/ì‹œê°„ */
    .datetime {
      position: absolute; top: 15px; left: 20px;
      font-size: 0.9rem; 
      color: rgba(55, 53, 47, 0.6);
      font-weight: 500;
    }

    /* 4. [ê¸°ëŠ¥ 1] ëª©í‘œ ì…ë ¥/ì „ì‹œ ì˜ì—­ (ì¤‘ì•™) */
    .goal-wrapper {
      width: 100%;
      /* ì´ë¯¸ì§€ì™€ ê²¹ì¹˜ì§€ ì•Šê²Œ ì˜¤ë¥¸ìª½ ì—¬ë°± í™•ë³´ */
      padding-right: 100px; 
      box-sizing: border-box;
      z-index: 10; /* ì´ë¯¸ì§€ë³´ë‹¤ ìœ„ì— ì˜¤ë„ë¡ */
    }

    /* ì…ë ¥ ëª¨ë“œ */
    #input-section {
      display: flex; flex-direction: column; align-items: center;
      width: 100%;
    }
    .question {
      font-size: 1.1rem; margin-bottom: 1rem;
      font-weight: 600; color: #37352F;
    }
    input[type="text"] {
      background: transparent; border: none;
      border-bottom: 1px solid rgba(55, 53, 47, 0.3);
      width: 90%; font-family: inherit;
      font-size: 1.3rem; color: #37352F;
      text-align: center; padding: 5px;
      outline: none; margin-bottom: 1rem;
    }
    input::placeholder { color: rgba(55, 53, 47, 0.2); font-size: 1rem; }
    .hint { font-size: 0.75rem; color: rgba(55, 53, 47, 0.4); }

    /* ì „ì‹œ ëª¨ë“œ */
    #display-section {
      display: none; flex-direction: column;
      align-items: center; justify-content: center;
    }
    .mission-label {
      font-size: 0.8rem; color: rgba(55, 53, 47, 0.5);
      margin-bottom: 0.5rem; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.05em;
    }
    .mission-text {
      font-size: 1.8rem; font-weight: 700;
      line-height: 1.2; margin-bottom: 1rem;
      word-break: keep-all; color: #37352F;
    }
    .finish-btn {
      background-color: white; 
      border: 1px solid rgba(55, 53, 47, 0.16);
      color: #37352F; padding: 4px 12px;
      border-radius: 4px; cursor: pointer;
      font-family: inherit; font-size: 0.8rem;
      transition: all 0.2s ease;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    .finish-btn:hover { background-color: rgba(55, 53, 47, 0.04); }

    /* 5. [ê¸°ëŠ¥ 2] í‡´ê·¼ ê²Œì´ì§€ (í•˜ë‹¨) */
    .work-wrapper {
      width: 100%;
      margin-top: 30px; /* ëª©í‘œ ì˜ì—­ê³¼ì˜ ê°„ê²© */
      padding-right: 100px; /* ì´ë¯¸ì§€ ê³µê°„ í™•ë³´ */
      box-sizing: border-box;
      display: flex; flex-direction: column; align-items: flex-start;
    }
    .progress-bg {
      width: 100%; height: 8px;
      background-color: rgba(55, 53, 47, 0.08);
      border-radius: 4px; overflow: hidden;
      margin-bottom: 6px;
    }
    .progress-fill {
      height: 100%;
      background-color: #37352F; /* ë…¸ì…˜ ê²€ì • */
      width: 0%; border-radius: 4px;
      transition: width 1s linear;
    }
    .work-text {
      font-size: 0.8rem; color: rgba(55, 53, 47, 0.6);
      font-weight: 500;
    }

    /* 6. [ê¸°ëŠ¥ 3] ìºë¦­í„° ì´ë¯¸ì§€ (ìš°ì¸¡ í•˜ë‹¨) */
    .char-img {
      position: absolute;
      bottom: 15px; right: 20px;
      width: 100px; /* ì´ë¯¸ì§€ í¬ê¸° ì¡°ì ˆ */
      height: auto;
      z-index: 5;
      /* ì´ë¯¸ì§€ê°€ ë„ˆë¬´ ì‹œì„ ì„ ëºì§€ ì•Šê²Œ ì‚´ì§ ì¡°ì ˆ ê°€ëŠ¥ */
      opacity: 0.95; 
    }

    /* 7. ì„œëª… ë° íŒì—… */
    .signature {
      position: absolute; bottom: 5px; left: 0; width: 100%;
      text-align: center; font-size: 0.6rem;
      color: rgba(55, 53, 47, 0.2); pointer-events: none;
    }

    #custom-modal {
      display: none; position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      background-color: rgba(255, 255, 255, 0.95);
      border-radius: 8px; flex-direction: column;
      justify-content: center; align-items: center; z-index: 999;
    }
    .modal-msg { font-size: 1rem; margin-bottom: 15px; font-weight: 600; }
    .modal-btn-group { display: flex; gap: 8px; }
    .modal-btn {
      padding: 6px 16px; border-radius: 4px; cursor: pointer;
      font-family: inherit; font-size: 0.85rem; border: 1px solid rgba(55, 53, 47, 0.16);
    }
    .btn-yes { background-color: #37352F; color: white; border: 1px solid #37352F; }
    .btn-no { background-color: transparent; }
    
    /* ëª¨ë°”ì¼ ëŒ€ì‘ */
    @media (max-width: 500px) {
      .goal-wrapper, .work-wrapper { padding-right: 0; }
      .char-img { display: none; } /* í™”ë©´ ì‘ìœ¼ë©´ ì´ë¯¸ì§€ ìˆ¨ê¹€ */
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="datetime" id="clock"></div>

    <div class="goal-wrapper">
      <div id="input-section">
        <div class="question">ì˜¤ëŠ˜ì˜ ëª©í‘œëŠ”?</div>
        <input type="text" id="goalInput" placeholder="ì…ë ¥ í›„ ì—”í„°" autocomplete="off" onkeypress="handleEnter(event)">
      </div>
      <div id="display-section">
        <div class="mission-label">TODAY'S GOAL</div>
        <div class="mission-text" id="goalDisplay"></div>
        <button class="finish-btn" onclick="openModal()">ì™„ë£Œ & ì´ˆê¸°í™”</button>
      </div>
    </div>

    <div class="work-wrapper">
      <div class="progress-bg">
        <div class="progress-fill" id="progressBar"></div>
      </div>
      <div class="work-text" id="workText">ê³„ì‚° ì¤‘...</div>
    </div>

    <img src="./stamp.png" class="char-img" alt="character">

    <div id="custom-modal">
      <div class="modal-msg">ëª©í‘œë¥¼ ì™„ë£Œí•˜ê³  ì´ˆê¸°í™”í• ê¹Œìš”?</div>
      <div class="modal-btn-group">
        <button class="modal-btn btn-yes" onclick="confirmReset()">ë„¤</button>
        <button class="modal-btn btn-no" onclick="closeModal()">ì•„ë‹ˆì˜¤</button>
      </div>
    </div>

    <div class="signature">nomadplanner</div>
  </div>

  <script>
    /* === ì„¤ì • === */
    const WORK_START = 9; // ì¶œê·¼ 9ì‹œ
    const WORK_END = 18;  // í‡´ê·¼ 18ì‹œ (ì˜¤í›„ 6ì‹œ)

    /* === ì•ˆì „í•œ ì €ì¥ì†Œ (One Pick ë¡œì§) === */
    let memoryStorage = "";
    function saveGoalSafe(val) { try { localStorage.setItem('myOneFocus', val); } catch(e) { memoryStorage = val; } }
    function getGoalSafe() { try { return localStorage.getItem('myOneFocus'); } catch(e) { return memoryStorage; } }
    function removeGoalSafe() { try { localStorage.removeItem('myOneFocus'); } catch(e) { memoryStorage = ""; } }

    /* === í†µí•© ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ì‹œê³„ + í‡´ê·¼ê²Œì´ì§€) === */
    function updateAll() {
      const now = new Date();
      
      // 1. ë‚ ì§œ/ì‹œê°„ ì—…ë°ì´íŠ¸
      const month = now.getMonth() + 1;
      const date = now.getDate();
      const dayList = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
      const day = dayList[now.getDay()];
      const timeStr = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
      
      const clockEl = document.getElementById('clock');
      if(clockEl) clockEl.innerText = `${month}ì›” ${date}ì¼ (${day}) ${timeStr}`;

      // 2. í‡´ê·¼ ê²Œì´ì§€ ì—…ë°ì´íŠ¸
      const currentHour = now.getHours();
      const currentMin = now.getMinutes();
      const currentSec = now.getSeconds();

      const totalSec = (WORK_END - WORK_START) * 3600;
      let passedSec = 0;

      if (currentHour >= WORK_START && currentHour < WORK_END) {
        passedSec = (currentHour - WORK_START) * 3600 + (currentMin * 60) + currentSec;
      } else if (currentHour >= WORK_END) {
        passedSec = totalSec;
      }

      let percent = (passedSec / totalSec) * 100;
      if (percent < 0) percent = 0;
      if (percent > 100) percent = 100;

      const bar = document.getElementById('progressBar');
      const txt = document.getElementById('workText');
      
      if(bar) bar.style.width = `${percent}%`;
      
      if(txt) {
        if (currentHour < WORK_START) txt.innerText = `ì¶œê·¼ ì „ì…ë‹ˆë‹¤ â˜• (${Math.floor(percent)}%)`;
        else if (percent >= 100) txt.innerText = `í‡´ê·¼ ì‹œê°„ì…ë‹ˆë‹¤! ê³ ìƒí•˜ì…¨ì–´ìš” ğŸ‰`;
        else txt.innerText = `í‡´ê·¼ê¹Œì§€ ${100 - Math.floor(percent)}% ë‚¨ì•˜ì–´ìš” ğŸ”¥`;
      }
    }

    /* === ëª©í‘œ(One Pick) í™”ë©´ ì œì–´ === */
    function showInputMode() {
      document.getElementById('input-section').style.display = 'flex';
      document.getElementById('display-section').style.display = 'none';
      const input = document.getElementById('goalInput');
      if(input) { input.value = ""; input.focus(); }
    }

    function showDisplayMode(text) {
      document.getElementById('input-section').style.display = 'none';
      document.getElementById('display-section').style.display = 'flex';
      document.getElementById('goalDisplay').innerText = text;
    }

    function handleEnter(e) {
      if (e.key === 'Enter') {
        const val = e.target.value;
        if(val.trim() !== "") {
          saveGoalSafe(val);
          showDisplayMode(val);
        }
      }
    }

    /* === íŒì—… ì œì–´ === */
    function openModal() { document.getElementById('custom-modal').style.display = 'flex'; }
    function closeModal() { document.getElementById('custom-modal').style.display = 'none'; }
    function confirmReset() {
      removeGoalSafe();
      closeModal();
      showInputMode();
    }

    /* === ì´ˆê¸°í™” (ì¦‰ì‹œ ì‹¤í–‰) === */
    (function init() {
      updateAll();
      setInterval(updateAll, 1000); // 1ì´ˆë§ˆë‹¤ ê°±ì‹ 

      const saved = getGoalSafe();
      if(saved) showDisplayMode(saved);
      else showInputMode();
    })();
  </script>
</body>
</html>
