<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Progress Widget</title>
    <style>
        /* ë…¸ì…˜ ì»¬ëŸ¬ ì‹œìŠ¤í…œ */
        :root {
            --fg: #37352f;
            --muted: #787774;
            --bar-bg: rgba(55, 53, 47, 0.08);
            --bar-fill: #37352f; /* ê¸°ë³¸: ê²€ì • */
            --blue: #2383e2;     /* ë…¸ì…˜ íŒŒë‘ */
            --red: #e03e3e;      /* ë…¸ì…˜ ë¹¨ê°• */
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --fg: #d4d4d4;
                --muted: #9b9a97;
                --bar-bg: rgba(255, 255, 255, 0.1);
                --bar-fill: #ffffff;
            }
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple SD Gothic Neo", sans-serif;
            background-color: transparent;
            color: var(--fg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            width: 100%;
            padding: 10px 20px;
            max-width: 500px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 16px; /* ë°” ì‚¬ì´ ê°„ê²© */
        }

        .progress-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .label {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .percent {
            font-variant-numeric: tabular-nums; /* ìˆ«ì ë„ˆë¹„ ê³ ì • */
            color: var(--muted);
            font-size: 0.8rem;
        }

        .bar-bg {
            width: 100%;
            height: 8px; /* ë°” ë‘ê»˜ */
            background: var(--bar-bg);
            border-radius: 99px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            width: 0%;
            background: var(--bar-fill);
            border-radius: 99px;
            transition: width 0.5s cubic-bezier(0.22, 1, 0.36, 1);
        }

        /* ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
        .icon { font-size: 1rem; }

    </style>
</head>
<body>

    <div class="container" id="app">
        </div>

    <script>
        // --- ğŸ› ï¸ ì„¤ì • ë° ë°ì´í„° ---
        const $ = (s) => document.querySelector(s);
        const getParam = (k) => new URL(location.href).searchParams.get(k);

        // ê¸°ë³¸ ì•„ì´í…œ (ìˆ˜ëª…ì€ ì˜µì…˜)
        const items = [
            { id: 'year', label: 'Year', icon: 'ğŸ—“ï¸' },
            { id: 'month', label: 'Month', icon: 'ğŸ“…' },
            { id: 'week', label: 'Week', icon: 'ğŸ”¥' }, // ì›”ìš”ì¼ ì‹œì‘
            { id: 'day', label: 'Day', icon: 'â˜€ï¸' },
        ];

        // URL íŒŒë¼ë¯¸í„°ë¡œ ìƒë…„ì›”ì¼(?dob=1995-12-25)ì´ ìˆìœ¼ë©´ Life ì¶”ê°€
        const dobParam = getParam('dob');
        if (dobParam) {
            items.unshift({ id: 'life', label: 'Life', icon: 'ğŸŒ±' }); // ë§¨ ìœ„ì— ì¶”ê°€
        }

        // --- 1. ì´ˆê¸° HTML ìƒì„± ---
        const app = document.getElementById('app');
        items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'progress-item';
            div.innerHTML = `
                <div class="header">
                    <div class="label"><span class="icon">${item.icon}</span> ${item.label}</div>
                    <div class="percent" id="pct-${item.id}">0%</div>
                </div>
                <div class="bar-bg">
                    <div class="bar-fill" id="bar-${item.id}"></div>
                </div>
            `;
            app.appendChild(div);
        });

        // --- 2. ê³„ì‚° ë¡œì§ ---
        function getProgress(start, end, now) {
            const total = end - start;
            const current = now - start;
            let pct = (current / total) * 100;
            if (pct < 0) pct = 0;
            if (pct > 100) pct = 100;
            return pct;
        }

        function tick() {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth(); // 0~11
            const date = now.getDate();
            
            // 1. Day: ì˜¤ëŠ˜ 00:00 ~ ë‚´ì¼ 00:00
            const startDay = new Date(year, month, date);
            const endDay = new Date(year, month
