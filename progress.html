lets(
	/* 1. 현재 시간 및 기준 설정 */
	now, now(),
	
	/* 2. 정확한 시작 시점 계산 (시간 단위 정밀도 향상) */
	/* 연초: 올해-01-01 00:00 */
	startYear, parseDate(format(year(now)) + "-01-01"), 
	/* 월초: 이번달-01 00:00 (날짜에서 일수만큼 빼서 계산) */
	startMonth, dateSubtract(dateSubtract(now, date(now) - 1, "days"), hour(now) * 60 + minute(now), "minutes"),
	/* 주초: 이번주 일요일(또는 설정값) 00:00 */
	startWeek, dateSubtract(dateSubtract(now, day(now), "days"), hour(now) * 60 + minute(now), "minutes"),
	/* 일초: 오늘 00:00 */
	startDay, dateSubtract(dateSubtract(now, hour(now), "hours"), minute(now), "minutes"),

	/* 3. 다음 시점 계산 (종료 지점) */
	nextYear, dateAdd(startYear, 1, "years"),
	nextMonth, dateAdd(startMonth, 1, "months"),
	nextWeek, dateAdd(startWeek, 1, "weeks"),
	nextDay, dateAdd(startDay, 1, "days"),

	/* 4. 퍼센트 정밀 계산 (모두 '분' 단위 차이로 계산하여 통일) */
	pctYear, round(dateBetween(now, startYear, "minutes") / dateBetween(nextYear, startYear, "minutes") * 1000) / 10,
	pctMonth, round(dateBetween(now, startMonth, "minutes") / dateBetween(nextMonth, startMonth, "minutes") * 1000) / 10,
	pctWeek, round(dateBetween(now, startWeek, "minutes") / dateBetween(nextWeek, startWeek, "minutes") * 1000) / 10,
	pctDay, round(dateBetween(now, startDay, "minutes") / dateBetween(nextDay, startDay, "minutes") * 1000) / 10,

	/* 5. 디자인 설정 */
	iconFull, style("▓ ", "blue"),    
	iconEmpty, style("░ ", "grey"),    
	iconProgress, style("▒ ", "grey"),
	headerStyle, "grey",

	/* 6. 출력 */
	style(format(year(now)) + "년의 " + format(dateBetween(now, startYear, "days") + 1).style("blue", "b") + "번째 날이에요.", "b", headerStyle) + "\n\n" +
	
	lets(
		result, pctYear,
		finished, floor(result / 10), unfinished, floor((100 - result) / 10), inProgress, 10 - finished - unfinished,
		repeat(iconFull, finished) + if(inProgress > 0, iconProgress, "") + repeat(iconEmpty, unfinished) + style(" Year: " + format(result) + "%",  "grey" ,"i")
	) + "\n" +
	
	lets(
		result, pctMonth,
		finished, floor(result / 10), unfinished, floor((100 - result) / 10), inProgress, 10 - finished - unfinished,
		repeat(iconFull, finished) + if(inProgress > 0, iconProgress, "") + repeat(iconEmpty, unfinished) + style(" Month: " + format(result) + "%",  "grey" ,"i") 
	) + "\n" +

	lets(
		result, pctWeek,
		finished, floor(result / 10), unfinished, floor((100 - result) / 10), inProgress, 10 - finished - unfinished,
		repeat(iconFull, finished) + if(inProgress > 0, iconProgress, "") + repeat(iconEmpty, unfinished) + style(" Week: " + format(result) + "%",  "grey" ,"i") 
	) + "\n" +

	lets(
		result, pctDay,
		finished, floor(result / 10), unfinished, floor((100 - result) / 10), inProgress, 10 - finished - unfinished,
		repeat(iconFull, finished) + if(inProgress > 0, iconProgress, "") + repeat(iconEmpty, unfinished) + style(" Day: " + format(result) + "%", "grey" ,"i") 
	)
)
